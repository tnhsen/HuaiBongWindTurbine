<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="Style.css" />
    <title>Huai Bong Wind Turbine</title>
  </head>
  <body>
    <div id="content">
      <div id="homepage" class="page active"></div>
      <div id="istrue" class="page"></div>
      <div id="fchoice" class="page"></div>
      <div id="schoice" class="page"></div>
      <div id="tchoice" class="page"></div>
    </div>
  </body>

  <script>
  let historyStack = [];
  
  function scrollToNext() {
    const activePage = document.querySelector(".page.active");
    if (!activePage) return;
    const scrollContainer = activePage.querySelector('.fchoice-container');
    if (!scrollContainer) return;
    const sections = activePage.querySelectorAll('section');
    
    const currentScroll = scrollContainer.scrollTop;
    const viewportHeight = scrollContainer.clientHeight;
    if (currentScroll + viewportHeight >= scrollContainer.scrollHeight - 50) {
      scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
      return;
    }
    for (let i = 0; i < sections.length; i++) {
      const sectionTop = sections[i].offsetTop;
      if (sectionTop > currentScroll + 10) {
        scrollContainer.scrollTo({ top: sectionTop, behavior: 'smooth' });
        break; 
      }
    }
  }

  function setupScrollAnimation() {
    const activePage = document.querySelector(".page.active");
    if (!activePage) return;

    const header = activePage.querySelector("#sticky-header");
    const scrollContainer = activePage.querySelector('.fchoice-container');
    const scrollBtn = activePage.querySelector("#scroll-btn");
    const sections = activePage.querySelectorAll(".card-section");

    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const content = entry.target.querySelector('.content-box');
        const img = entry.target.querySelector('img'); 

        if (entry.isIntersecting) {
          if (content) content.classList.add('active-anim');
          if (img) img.classList.add('active-anim');
        } else {
          if (content) content.classList.remove('active-anim');
          if (img) img.classList.remove('active-anim');
        }
      });
    }, { threshold: 0.3 });

    sections.forEach(section => sectionObserver.observe(section));

    if (header && scrollContainer) {
      const handleScroll = () => {
        const scrollTop = scrollContainer.scrollTop;
        const viewportHeight = scrollContainer.clientHeight;
        const scrollHeight = scrollContainer.scrollHeight;
        
        if (scrollTop > 50) {
          header.classList.add("shrink");
        } else {
          header.classList.remove("shrink");
        }

        if (scrollBtn) {
           const isBottom = scrollTop + viewportHeight >= scrollHeight - 50;
           if (isBottom) {
             scrollBtn.classList.add("rotate");
           } else {
             scrollBtn.classList.remove("rotate");
           }
        }
      };

      scrollContainer.onscroll = handleScroll;
      handleScroll();
    }
  }

  async function showPage(pageId, filePath, saveHistory = true) {
    const currentActive = document.querySelector(".page.active");
    if (currentActive && saveHistory) {
      historyStack.push(currentActive.id);
    }

    const pages = document.querySelectorAll(".page");
    pages.forEach((page) => page.classList.remove("active"));

    const selectedPage = document.getElementById(pageId);
    
    if (selectedPage) {
        if (filePath && selectedPage.innerHTML.trim() === "") {
          try {
            const response = await fetch(filePath);
            if (response.ok) {
              selectedPage.innerHTML = await response.text();
            }
          } catch (error) {
            console.error("Error loading file:", error);
          }
        }
        selectedPage.classList.add("active");

        const scrollContainer = selectedPage.querySelector('.fchoice-container');
        const header = selectedPage.querySelector("#sticky-header");
        const scrollBtn = selectedPage.querySelector("#scroll-btn");

        if (scrollContainer) scrollContainer.scrollTop = 0;
        if (header) header.classList.remove("shrink");
        if (scrollBtn) scrollBtn.classList.remove("rotate");
        
        setTimeout(() => {
           setupScrollAnimation();
        }, 50);
        
    } else {
        console.error("ไม่พบหน้านี้ใน HTML: " + pageId);
    }
    console.log("History:", historyStack);
  }

  function goBack() {
    if (historyStack.length === 0) {
      alert("ย้อนกลับไม่ได้แล้วครับ นี่หน้าแรกสุด");
      return;
    }
    const previousPageId = historyStack.pop();
    showPage(previousPageId, null, false);
  }

  showPage('homepage', 'pages/home.html', false);
</script>
</html>
